!(function (t) {
  "use strict";
  "function" == typeof define && define.amd
    ? define(["jquery"], t)
    : "undefined" != typeof exports
    ? (module.exports = t(require("jquery")))
    : t(jQuery);
})(function (g) {
  "use strict";
  var l = window.Highlights || {};
  ((l = function (t, i) {
    var e = this;
    (this.container = g(t)),
      (this.objhightlights = i.objhightlights || []),
      (e.defaults = {
        enabled: !1,
        obj: null,
        pg: 0,
        parser: null,
        highlights: [],
        tagsToRemove: ["strong", "a", "b", "i", "em", "sub", "sup"],
        list: null,
      }),
      (e.settings = g.extend({}, e.defaults, i)),
      this.init();
  }).prototype.init = function () {
    if (this.settings.highlights.length) {
      for (var t = 0; t < this.settings.highlights.length; t++) {
        var i = g(
          this.settings.parser +
            "[data-id=" +
            this.settings.highlights[t].pg +
            "]"
        );
        this.carregaHighlight(
          this.settings.highlights[t].pg,
          i,
          this.settings.highlights[t].message,
          this.settings.highlights[t].titulo
        );
        var e = this.objhightlights[t],
          i = e.textHighlighter.serializeHighlights();
        this.criaCard(e, i, this.settings.highlights[t].titulo);
      }
      this.settings.list.parent().removeClass("empty");
    }
    this.settings.list && this.montaHighlightList();
  }),
    (l.prototype.montaHighlightList = function () {
      this.settings.list.mCustomScrollbar({
        theme: "minimal-dark",
      });
    }),
    (l.prototype.habilitaHighlight = function () {
      this.settings.enabled = !this.settings.enabled;
    }),
    (l.prototype.carregaHighlight = function (e, h, s, g) {
      var t,
        n = this,
        i = n.objhightlights.find((t) => t.pg == n.pg);
      i ||
        ((t = {
          onBeforeHighlight: function (t, i) {
            return !!n.settings.enabled;
          },
          onAfterHighlight: function (t) {
            var i = n.objhightlights.find((t) => t.pg == n.pg);
            i ? n.geraHighlight(i) : n.carregaHighlight(e, h, s, g);
          },
        }),
        (i = new TextHighlighter(h[0], t)),
        (t = {
          pg: e,
          textHighlighter: i,
          titulo: g || n.tituloAtual,
        }),
        n.objhightlights.push(t),
        h.attr("data-highlight-tela-id", e),
        s && i.deserializeHighlights(s));
    }),
    (l.prototype.criaCard = function (t, i, e) {
      var h = this,
        s = t.pg;
      (t.message = i.message),
        t.HighlightCard
          ? t.HighlightCard.update(i.text)
          : ((t.HighlightCard = new n({
              text: i.text,
              pg: s,
              titulo: e,
            })),
            t.HighlightCard.init(this.settings.list.find(".cards")),
            g(t.HighlightCard).on("delete", function () {
              h.removeHighlights(t);
            }));
    }),
    (l.prototype.geraHighlight = function (t) {
      var i = t.textHighlighter.serializeHighlights();
      this.criaCard(t, i, this.tituloAtual), this.gravaHighlight();
    }),
    (l.prototype.gravaHighlight = function () {
      for (
        var t = this.objhightlights.map((t) => t), i = [], e = 0;
        e < t.length;
        e++
      )
        t[e].message &&
          i.push({
            pg: t[e].pg,
            message: t[e].message,
            titulo: t[e].titulo,
          });
      i.length
        ? this.settings.list.parent().removeClass("empty")
        : this.settings.list.parent().addClass("empty"),
        this.container.trigger("setHighlight", [i]);
    }),
    (l.prototype.removeHighlights = function (e) {
      var h = this;
      e.textHighlighter.removeHighlights(),
        e.HighlightCard.card.height(e.HighlightCard.card.height()),
        e.HighlightCard.card.addClass("delete"),
        (e.HighlightCard.card[0].onanimationend = function (t) {
          e.HighlightCard.card.remove();
          var i = h.objhightlights.findIndex(function (t, i) {
            return t.pg == e.pg;
          });
          h.objhightlights.splice(i, 1), h.gravaHighlight();
        });
    }),
    (l.prototype._removeHighlights = function (t) {
      var e,
        i,
        h,
        s = this;
      s.settings.enabled &&
        ((e = this.highlighter),
        (i = g(this.obj).parent()),
        (h = g(i).prop("tagName").toLowerCase()),
        g(t).data("page"),
        (s = (i =
          -1 != s.settings.tagsToRemove.indexOf(h)
            ? s.container.parent().parent()
            : i).find(s.settings.tagsToRemove.join(",")).length),
        i.find(".highlighted").length,
        0 < s
          ? ("a" == h &&
              i.text().replace(/\s+/g, "") !=
                g(obj).text().replace(/\s+/g, "")) ||
            i.find(".highlighted").each(function (t, i) {
              e.removeHighlights(this);
            })
          : e.removeHighlights(this.obj),
        e.serializeHighlights());
    }),
    (l.prototype.setBindClick = function () {
      var t = this;
      this.container.find(".highlighted").off("click"),
        this.container.find(".highlighted").on("click", function () {
          t.removeHighlights(t.container);
        });
    }),
    (l.prototype.setTelaAtual = function (t, i, e) {
      (this.settings.pg = t),
        (this.pg = t),
        (this.telaAtual = i),
        (this.tituloAtual = e),
        this.carregaHighlight(t, this.telaAtual);
    });
  var n = window.Highlights || {};
  ((n = function (t) {
    (this.defaults = {
      text: "",
      pg: null,
      titulo: "",
    }),
      (this.settings = g.extend({}, this.defaults, t)),
      (this.card = g(
        '<div class="highlight-item tool-item"><div class="item-top-bar"><span class="titulo-item">' +
          this.settings.titulo +
          '</span><button class="delete-tool-item">Remover</button></div><div class="item-content"><div class="texto-card">' +
          this.settings.text.html() +
          "</div></div></div>"
      ));
  }).prototype.init = function (t) {
    var i = this;
    t.append(this.card),
      this.card.find(".item-content").mCustomScrollbar({
        theme: "minimal-dark",
      }),
      this.card.find(".delete-tool-item").on("click", function (t) {
        t.preventDefault(), i.delete();
      });
  }),
    (n.prototype.update = function (t) {
      (this.settings.text = t), this.card.find(".texto-card").html(t.html());
    }),
    (n.prototype.delete = function () {
      g(this).trigger("delete");
    }),
    (g.fn.highlights = function (t) {
      for (
        var i,
          e = this,
          h = t,
          s = Array.prototype.slice.call(arguments, 1),
          g = e.length,
          n = 0;
        n < g;
        n++
      )
        if (
          ("object" == typeof h || void 0 === h
            ? (e[n].highlights = new l(e[n], h))
            : (i = e[n].highlights[h].apply(e[n].highlights, s)),
          void 0 !== i)
        )
          return i;
      return e;
    });
});
