define(["jquery", "components/tools/toolcard.min"], function (n, t) {
  "use strict";
  var p = window.Postits || {};
  ((p = function (t, s) {
    (this.postits = {
      postits: [],
    }),
      (this.settings = n.extend(
        {},
        {
          list: null,
          parser: "",
          postits: [],
        },
        s
      )),
      (this.element = this.telaAtual = t);
    for (var i = 0; i < s.postits.length; i++) {
      var e = n(t).find(".tela[data-id=" + s.postits[i].pg + "]");
      (s.postits[i].tela = e), this.inserePostit(s.postits[i]);
    }
    this.settings.list && this.montaPostitsList();
  }).prototype.montaPostitsList = function () {
    this.settings.list.mCustomScrollbar({
      theme: "minimal-dark",
    });
  }),
    (p.prototype.inserePostit = function (t) {
      var s = {
          pg: this.pg,
          tela: this.telaAtual,
          titulo: this.tituloAtual,
          message: "",
          new: !0,
        },
        s = n.extend(!0, s, t),
        i = this,
        s = new e(s);
      s.inserePostit(),
        this.postits.postits.push(s),
        this.criaCard(s),
        n(s).on("setPostitData", function (t, s) {
          i.gravaPostits(s);
        });
    }),
    (p.prototype.setTelaAtual = function (t, s, i) {
      (this.pg = t), (this.telaAtual = s), (this.tituloAtual = i);
    }),
    (p.prototype.gravaPostits = function (t) {
      for (var s = [], i = this, e = 0; e < this.postits.postits.length; e++)
        this.postits.postits[e].settings.delete
          ? this.postits.postits[e].card.delete()
          : (s.push({
              titulo: this.postits.postits[e].settings.titulo,
              message: this.postits.postits[e].settings.message,
              pg: this.postits.postits[e].settings.pg,
              pos: this.postits.postits[e].settings.pos,
            }),
            this.postits.postits[e].card &&
              this.postits.postits[e].card.update(
                this.postits.postits[e].settings.message
              ));
      var o = this.postits.postits.findIndex(function (t, s) {
        return 1 == t.settings.delete;
      });
      -1 != o && this.postits.postits.splice(o, 1),
        this.postits.postits.length
          ? this.settings.list.parent().removeClass("empty")
          : setTimeout(() => {
              i.settings.list.parent().addClass("empty");
            }, 1e3),
        n(this.element).trigger("setPostit", [s]);
    }),
    (p.prototype.criaCard = function (i) {
      i.card ||
        ((i.card = new t({
          text: i.settings.message,
          pg: i.settings.pg,
          titulo: i.settings.titulo,
          element: i.obj,
        })),
        i.card.init(this.settings.list.find(".cards")),
        n(i.card).on("delete", function (t, s) {
          i.removePostit();
        })),
        this.settings.list.parent().removeClass("empty");
    });
  var e = window.Postit || {};
  ((e = function (t) {
    var s = this;
    (s.defaults = {
      code: '<div class="postit"><div class="barra"></div><a href="#" class="bt-minimizar-postit">-</a><a href="#" class="bt-fechar-postit">x</a><textarea maxlength="140" class="animate-all-5ms" placeholder="Digite seu texto"></textarea></div>',
      pg: null,
      titulo: "",
      message: "",
      pos: {
        x: 30,
        y: 0,
      },
    }),
      (s.settings = n.extend({}, s.defaults, t)),
      (this.container = t.tela),
      this.init();
  }).prototype.init = function () {}),
    (e.prototype.inserePostit = function () {
      var s,
        i = this;
      (this.obj = n(this.settings.code)),
        this.settings.pos.y ||
          ((t =
            ((n("#new-header").height() +
              30 +
              n(window).scrollTop() -
              this.settings.tela.offset().top) /
              this.settings.tela.height()) *
              100 +
            "%"),
          (this.settings.pos.y = t)),
        n(this.settings.tela).append(this.obj),
        (this.container = this.settings.tela),
        this.obj.find(".bt-fechar-postit").bind("click", function (t) {
          t.preventDefault(), i.removePostit();
        }),
        this.obj.find(".bt-minimizar-postit").bind("click", function (t) {
          t.preventDefault(), i.minimizaPostit();
        }),
        this.obj.find("textarea").bind("keyup", function () {
          (i.settings.message = n(this).val()), i.gravaPostit();
        }),
        this.obj.draggable({
          containment: "parent",
          handle: ".barra",
          cancel: "input,textarea,button,select,option",
          drag: function () {
            var t =
              (parseInt(i.obj.css("top")) / i.settings.tela.height()) * 100 +
              "%";
            (i.settings.pos = {
              x: parseInt(i.obj.css("left")),
              y: t,
            }),
              (i.settings.message = i.obj.find("textarea").val()),
              clearInterval(s),
              (s = setInterval(function () {
                i.gravaPostit(), clearInterval(s);
              }, 100));
          },
        });
      var t = {
        left: this.settings.pos.x,
        top: this.settings.pos.y,
      };
      this.obj.find("textarea").val(this.settings.message),
        this.obj.css(t),
        ("transition" != n.support.transition && !n.support.transition) ||
          this.obj
            .css({
              opacity: 0,
              perspective: "200px",
              rotateX: "90deg",
              rotateZ: "0",
              y: "-600px",
            })
            .transition(
              {
                opacity: 1,
                rotateX: 0,
                rotateZ: 10,
                y: 0,
              },
              500
            );
    }),
    (e.prototype.minimizaPostit = function (t) {
      this.obj.toggleClass("fechado");
    }),
    (e.prototype.removePostit = function () {
      this.gravaPostit({
        delete: !0,
      }),
        this.obj.animate(
          {
            transform: "scale(0.01,0.01)",
          },
          500,
          "easeInBack",
          function () {
            n(this).remove();
          }
        );
    }),
    (e.prototype.gravaPostit = function (t) {
      var s = {
        delete: !1,
      };
      (s = n.extend({}, s, t)).delete && (this.settings.delete = !0),
        n(this).trigger("setPostitData", [this.settings]);
    }),
    (n.fn.postits = function (t) {
      for (
        var s,
          i = this,
          e = t,
          o = Array.prototype.slice.call(arguments, 1),
          n = i.length,
          a = 0;
        a < n;
        a++
      )
        if (
          ("object" == typeof e || void 0 === e
            ? (i[a].postits = new p(i[a], e))
            : (s = i[a].postits[e].apply(i[a].postits, o)),
          void 0 !== s)
        )
          return s;
      return i;
    });
});
